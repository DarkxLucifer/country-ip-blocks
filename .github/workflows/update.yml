permissions:
  contents: write   # allow pushing with GITHUB_TOKEN

# ... earlier steps (checkout, setup-python, fetch) remain the same ...

      - name: Checkout (persist credentials)
        uses: actions/checkout@v4
        with:
          persist-credentials: true   # allow using GITHUB_TOKEN for git push

      - name: Commit & push to branch
        env:
          REPO: ${{ github.repository }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "actions@github.com"
          BRANCH="update/country-cidrs-$(date +%s)"
          git checkout -b "$BRANCH"
          git add generated/*.cidr generated/*.debug generated/*.stderr || true
          git commit -m "Automated update of country CIDR lists" || echo "No changes to commit"
          git push --set-upstream origin "$BRANCH"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Automated update of country CIDR lists"
          title: "Automated update: country CIDR lists"
          body: |
            This PR contains updated generated country CIDR lists and debug files.
          base: main
